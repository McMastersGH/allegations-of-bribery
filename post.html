<!doctype html>
<html lang="en">
<head>
  <link rel="icon" href="./favicon.ico" />
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Post — Allegations of Bribery</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="./css/styles.css" />

  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            panel: "#111827",
            panel2: "#0b0e13",
            stroke: "#1f2933",
            page: "#0f1216"
          }
        }
      }
    }
  </script>
</head>

<body class="bg-page text-slate-200 antialiased">
  <div id="siteHeader"></div>

  <main class="mx-auto max-w-6xl px-4 py-6">
    <section class="card">
      <div class="row" style="justify-content:space-between; align-items:flex-start; gap:12px;">
        <div>
          <h2 id="postTitle">Loading…</h2>

          <!-- post.js expects spans inside #postMeta -->
          <div id="postMeta" class="muted small" style="margin-top:6px;">
            <span class="author-name"></span>
            <span class="post-date"></span>
          </div>
        </div>

      </div>

      <div id="postContent" class="prose" style="margin-top:14px;"></div>

      <!-- Author badge (populated by js/post.js). Hidden for anonymous posts -->
      <div id="authorBadge" class="card author-badge" style="margin-top:14px; display:none;"></div>

      <!-- Post footer ad placeholder -->
      <div id="postFooterAd" class="card" style="margin-top:14px;">
        <div class="text-xs font-semibold uppercase tracking-wider text-slate-400">Sponsored</div>
        <div id="ad-slot-post" class="mt-2 ad-slot ad-stub">Post footer ad placeholder</div>
      </div>
    </section>

    <section class="card" style="margin-top:14px;">
      <h3>Attachments — documents & images</h3>
      <p id="attachmentsHelp" class="small muted" style="margin-top:6px;">Files shown below are supporting documents or images uploaded by the author (PDF, DOCX, JPG, PNG).</p>
      <div id="attachments" aria-describedby="attachmentsHelp" class="list" style="margin-top:10px;"></div>
    </section>

    <section class="card" style="margin-top:14px;">
      <div class="row" style="justify-content:space-between; align-items:center;">
        <h3>Comments</h3>
      </div>

      <!-- Anonymity toggle panel (post.js shows/hides this) -->
      <div id="commentAnonPanel" class="panel" style="margin:12px 0; display:none;">
        <label class="checkrow">
          <input id="commentAnonToggle" type="checkbox" />
          <span>
            Comment anonymously<br>
            <span class="small muted">If enabled, your comments display “Chose Anonymity”.</span>
          </span>
        </label>
        <p id="commentAnonStatus" class="small muted" style="margin-top:8px;"></p>
      </div>
      <p id="anonNotice" class="anon-notice" style="display:none;">You are posting comments anonymously — your name will not appear with comments.</p>
      <div id="commentFormWrap" class="card" style="margin-top:12px;">
        <label class="label" for="commentText">Add a comment</label>
        <textarea id="commentText" spellcheck="true" class="textarea" rows="4" placeholder="Write a comment..." disabled></textarea>

        <div class="row gap" style="margin-top:10px;">
          <button id="commentBtn" class="btn" type="button" disabled>Post comment</button>
          <button id="checkCommentBtn" class="rounded-md border border-stroke px-3 py-2 text-sm text-slate-200" type="button">Check spelling</button>
          <div id="commentMsg" class="muted small" style="align-self:center;"></div>
        </div>
      </div>

      <div id="comments" class="list" style="margin-top:14px;"></div>
    </section>
  </main>

  <!-- Preserve next= behavior for login -->
  <script>
    const link = document.getElementById("loginLink");
    if (link) {
      const next = encodeURIComponent(window.location.pathname + window.location.search);
      link.href = `./login.html?next=${next}`;
    }
  </script>

  <script type="module">
    import initShell from "./js/shell.js";
    await initShell();
  </script>

  <script type="module">
    import { wireSpellcheck } from "./js/spellcheck.js";
    import { getSession } from "./js/auth.js";

    (async () => {
      const session = await getSession();
      const btn = document.getElementById('checkCommentBtn');
      if (!session) {
        if (btn) btn.style.display = 'none';
        return;
      }
      // wired only when signed in
      wireSpellcheck({ textareaId: 'commentText', buttonId: 'checkCommentBtn' });
    })();
  </script>

  <script>
    // Show header back button only when arriving from a forum list; use history.back() if possible.
    (function () {
      const btn = document.getElementById("headerBack");
      if (!btn) return;

      const ref = document.referrer || "";
      const show = ref.includes("/forum.html");
      if (!show) return;
      btn.style.display = "inline-flex";

      btn.addEventListener("click", (e) => {
        e.preventDefault();
        if (window.history.length > 1) {
          window.history.back();
        } else {
          window.location.href = "./index.html";
        }
      });
    })();
  </script>

  <script type="module" src="./js/post.js"></script>
</body>
</html>