<!doctype html>
<html lang="en">
<head>
  <link rel="icon" href="./favicon.ico">
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Write — Allegations of Bribery</title>

  <!-- Keep your existing site styles (buttons, inputs, etc.) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="./css/styles.css" />

  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            panel: "#111827",
            panel2: "#0b0e13",
            stroke: "#1f2933",
            page: "#0f1216"
          }
        }
      }
    }
  </script>
</head>

<body class="bg-page text-slate-200 antialiased">

  <div id="siteHeader"></div>

  <!-- Main -->
  <main class="mx-auto max-w-6xl px-4 py-6">
    <!-- Gate / status -->
    <div id="writeGate" class="rounded-lg border border-stroke bg-panel p-4 mb-5" style="display:none;"></div>

    <!-- Header card -->
    <div class="rounded-lg border border-stroke bg-panel p-5">
      <div class="flex items-start justify-between gap-4">
        <div>
          <h1 class="text-xl font-semibold">New thread</h1>
          <p class="mt-1 text-sm text-slate-400" id="postingIn"></p>
        </div>
      </div>
    </div>

    <!-- Compose card -->
    <section class="mt-5 rounded-lg border border-stroke bg-panel2 p-5">
      <div class="flex items-center justify-between">
        <h2 class="text-sm font-semibold">Compose</h2>
        <label class="inline-flex items-center gap-2 text-sm text-slate-300">
          <input type="checkbox" id="anonToggle" class="h-4 w-4">
          <span>Post anonymously</span>
        </label>
      </div>

      <p id="anonNotice" class="anon-notice" style="display:none">You are posting anonymously — your name will not appear with this post.</p>
      <p class="mt-2 text-xs text-slate-500" id="anonStatus"></p>
      <p class="mt-2 text-sm text-slate-400" id="statusMsg"></p>

      <div class="mt-4">
        <label class="text-xs font-semibold uppercase tracking-wider text-slate-400">Title</label>
        <input id="title" spellcheck="true" class="mt-2 w-full rounded-md border border-stroke bg-panel px-3 py-2 text-sm text-slate-200" placeholder="Thread title" />
      </div>

      <div class="mt-4">
        <label class="text-xs font-semibold uppercase tracking-wider text-slate-400">Body</label>
        <textarea id="content" spellcheck="true" class="mt-2 w-full rounded-md border border-stroke bg-panel px-3 py-2 text-sm text-slate-200" rows="10" placeholder="Write your post..."></textarea>
        <p class="mt-2 text-xs text-slate-500">Tip: keep it factual; add sources where possible.</p>
      </div>

      <div id="composeAttachments" class="mt-4">
        <label class="text-xs font-semibold uppercase tracking-wider text-slate-400">Attachments — documents & images</label>
        <div class="attachment-box mt-2">
          <!-- Hidden native input kept for form handling; custom controls provide consistent UI -->
          <input id="files" aria-describedby="filesHelp" accept=".pdf,.doc,.docx,.txt,image/*,video/*,audio/*" class="input native-file-input" type="file" multiple />

          <div class="custom-file-control">
            <button id="filesBtn" type="button" class="btn">Browse files</button>
            <span id="filesLabel" class="small muted" style="margin-left:10px;">No files selected.</span>
          </div>

          <p id="filesHelp" class="mt-2 text-xs text-slate-500">Use this box to upload supporting documents or images (PDF, DOCX, JPG, PNG). Multiple files are allowed.</p>
        </div>

        <!-- File preview container: auto-shown when files are selected -->
        <div id="filePreviewContainer" class="mt-3 max-w-3xl w-full" style="display:none;">
          <div class="file-preview-card p-3 rounded-md border border-stroke bg-panel">
            <div class="flex items-center justify-between mb-2">
              <strong class="text-sm">File preview</strong>
              <div>
                <button id="hidePreviewBtn" type="button" class="btn">Hide preview</button>
              </div>
            </div>
            <div id="filePreview" class="file-preview-content"></div>
          </div>
        </div>
      </div>

      <div class="mt-5 flex items-center gap-3">
        <!-- IMPORTANT: type="button" prevents refresh -->
        <button id="publishBtn" class="rounded-md bg-slate-800 px-4 py-2 text-sm font-semibold text-white hover:bg-slate-700" type="button">
          Publish
        </button>
        <button id="saveDraftBtn" class="rounded-md border border-slate-700 px-4 py-2 text-sm font-semibold text-slate-200 hover:bg-slate-800" type="button">
          Save Draft
        </button>
        <button id="checkDocBtn" class="rounded-md border border-stroke px-3 py-2 text-sm text-slate-200" type="button">Check spelling</button>
      </div>

      <p class="mt-4 text-xs text-slate-500">
        Publishing requires an approved author account. If you are not approved, you will be blocked.
      </p>
    </section>
  </main>

  <!-- pdfjs (kept) -->
  <script type="module">
    import * as pdfjsLib from "./js/vendor/pdfjs/pdf.min.mjs";
    pdfjsLib.GlobalWorkerOptions.workerSrc = "./js/vendor/pdfjs/pdf.worker.min.mjs";
    window.pdfjsLib = pdfjsLib;
  </script>

  <script type="module">
    import initShell from "./js/shell.js";
    await initShell();
  </script>

  <script type="module">
    import { wireSpellcheck } from "./js/spellcheck.js";
    import { getSession } from "./js/auth.js";

    (async () => {
      const session = await getSession();
      const btn = document.getElementById('checkDocBtn');
      if (!session) {
        if (btn) btn.style.display = 'none';
        return;
      }
      // wire spellcheck for compose fields only when signed in
      wireSpellcheck({ textareaId: 'content', buttonId: 'checkDocBtn' });
    })();
  </script>

  <script type="module" src="./js/write.js"></script>
</body>
</html>